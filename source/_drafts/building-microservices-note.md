# 第1章 微服务

微服务定义：一些协同工作的小而自治的服务

特性：

- 足够小
- 具有自治性
- 暴露自己的API并通过API进行相互通讯

好处：

- 支持技术异构
- 独立，避免联级故障

# 第3章 如何建模服务

限界上下文：每个限界上下文内分为两部分，一部分不需要和外部通讯，另一部分则需要

一个服务可能需要去和另一个服务的隐藏模型打交道，但是不应该将隐藏内容全部暴露，而是提取一个共享模型出来

# 第4章 集成

集成：就是用何种通讯协议和API暴露方式将服务组织起来

#### 跨业务流程的处理选择：编排与协同

- **编排（orchestration）**：由一个中心服务作为主体，指挥各个部分操作从而驱动整个流程，并负责管理和验证这些步骤是否成功。大多以**同步**的 请求 / 响应 模式为主。问题在于中心服务承担太多职责，成为”上帝服务“。
- **协同（choreography）**：中心服务通过异步方式触发事件，相关的其他服务通过订阅来**自行响应**这个事件进行操作。问题在于难以知道流程是否正常运作，需要有其他手段来保证（比如跨服务的监控）

#### RPC 的脆弱性

隐藏远程调用的方式可能导致调用和被调用间的紧耦合

#### 异步架构的复杂性

- 无法预测的返回时间点为业务带来了危险性，这要求我们保证为几乎每个操作建立完善的错误保护与监控机制（超时，操作对象错误，总体管理，消息医院等）
- 异步模式需要对传统顺序程序进行思维上的转换

#### 服务即状态机

即每个服务应该拥有和自己的行为相关的所有逻辑

#### 避免共享代码（DRY）

因为同样可能导致服务间耦合，同样的原则甚至可以应用到编程风格的共享上（比如编写客户端库的人如果和服务端编写者是同一人，仍然可能类似的危险）

#### 尽可能使用【引用】访问资源

#### 版本管理

- 语义化版本管理
- 保留不同的接口共存，延迟弃用

# 第5章 分解单块系统

这一节讲述了如何分解一个系统以及相关的实现

### 关于接缝

### 基本限界上下文的分解，代码的移动

### 决定分解一个系统的原因

### 分解数据库

#### 打破外键关系

使用schema spy 检查数据库结构，外键的约束将变为对 API 的访问

#### 静态数据的共享

放入同一个静态文件，在复杂的情况下抽取出来作为新服务

#### 非静态数据的共享

必要情况下，可能需要抽取一些抽象概念，进行**具象化建模**

#### 共享表

尽可能拆分同时被不同服务访问的表

### 进行数据库重构的过程

先分离表结构再分离服务

### 分布式事务

原因：在分布式架构下，一个完整的系统可能会被拆分为各个分割的步骤，导致我们的事务可能会呈现非原子性

措施：采用一些**分布式事务**的处理手段，比如通过一个称作事务管理器的工具同一编配事务的各个阶段，<u>通过”两阶段提交“的方式，组成一个事务的每个参与者通过投票告诉事务管理器自己的运行情况，只要管理器收到一个否定的投票，事务管理器就会让所有的参与者回退。</u>

问题：中央协调器的状态会影响所有参与事务的参与者的运行。

### 报告的存放数据库

报告：各种各样的操作时出现的问题，比如各类程序的log

运行过程中可能会产生大量的log，为此必须要将这些 log 单独存放出一个数据库

### 通过直接访问数据库的程序导出数据为报告



### 事件数据的导出与导出的备份

## 第6章 部署

### 6.1 CI持续集成



